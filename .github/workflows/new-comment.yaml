name: "Handle new comments"
on:
  issue_comment:
    types: [created]
jobs:
  pull-request-comment:
    name: On Pull Request Comment
    if: github.event.issue.pull_request
    runs-on: ubuntu-latest
    outputs:
      labeled: ${{ steps.comment-labeler.outputs.labeled }}
    steps:
      # Adds specified label when comment contains listed keywords
      - name: Comment Labeler
        id: comment-labeler
        uses: Amwam/issue-comment-action@v1.3.1
        with:
          keywords: '["[QA Approved]"]'
          labels: '["qa-approved"]'
          github-token: "${{ secrets.GITHUB_TOKEN }}"
      - name: Comment Labeler Output
        run: echo "view your env"
        shell: bash
        env:
          OUTPUT: ${{ toJSON(steps.comment-labeler) }}
      - name: Is QA Approved?
        run: |
          echo "Is this PR Labeled? ${IS_LABELED}"
          IS_LABELED === true && (echo "You have the QA approved label" && exit 0) || (echo "::error::${ERROR_MESSAGE}" && exit 1)
        shell: bash
        env:
          IS_LABELED: ${{ steps.comment-labeler.outputs.labeled }}
  check-label:
    name: Is QA Approved
    runs-on: ubuntu-latest
    needs: pull-request-comment
    steps:
      - run: |
          echo "Is this PR Labeled? ${IS_LABELED}"
          echo "needs ${IS_LABELED}"
        #          IS_LABELED === "true" && (echo "You have the QA approved label" && exit 0) || (echo "::error::${ERROR_MESSAGE}" && exit 1)
        shell: bash
        env:
          ERROR_MESSAGE: "QA Approved label not found"
          IS_LABELED: ${{needs.pull-request-comment.outputs.labeled}}
          PREV_STEP_OUTPUT: ${{ toJSON(needs) }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
