name: Notify Slack

on:
  push: # Runs on merge (push) to $branch
    branches:
      - notify-slack
concurrency:
  # Only allow one workflow in the 'main' group to run at a time. Others will queue up
  # https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions#concurrency
  group: main

jobs:
  branch-build:
    name: Main Branch Build
    runs-on: ubuntu-latest
    outputs:
      all-files: ${{ steps.build.outputs.all-files }}
    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/actions/branch-build
        id: build
        with:
          packages-access-token: ${{ secrets.PACKAGES_ACCESS_TOKEN }}
  changed-files:
    name: Changed Files
    needs: [branch-build]
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo Changed files information
          echo ${{ needs.branch-build.outputs.all-files }}
        shell: bash
        env:
          GITHUB_CONTEXT: ${{ toJSON(github) }}
